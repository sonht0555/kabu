var a0_0x2fa1f0=a0_0x2ae6;(function(_0x11718f,_0x535ae3){var _0x5a4b04=a0_0x2ae6,_0x5116de=_0x11718f();while(!![]){try{var _0x399e90=parseInt(_0x5a4b04(0x1b6))/0x1+-parseInt(_0x5a4b04(0x1e7))/0x2*(parseInt(_0x5a4b04(0x1b3))/0x3)+-parseInt(_0x5a4b04(0x1e9))/0x4+-parseInt(_0x5a4b04(0x1e6))/0x5+parseInt(_0x5a4b04(0x1d3))/0x6+parseInt(_0x5a4b04(0x1ab))/0x7+parseInt(_0x5a4b04(0x1cf))/0x8;if(_0x399e90===_0x535ae3)break;else _0x5116de['push'](_0x5116de['shift']());}catch(_0x44d067){_0x5116de['push'](_0x5116de['shift']());}}}(a0_0x2426,0x237bd));import*as a0_0x42acc6 from'./main.js';import{localStorageFile}from'./storage.js';var clientId=a0_0x2fa1f0(0x1df),clientSecret=a0_0x2fa1f0(0x1d0);function authorizeWithDropbox(){var _0x4c2644=a0_0x2fa1f0,_0x103546=window[_0x4c2644(0x1c6)][_0x4c2644(0x1ec)][_0x4c2644(0x1ae)]('?')[0x0],_0x1a8317=_0x4c2644(0x1ef),_0x16d000='offline',_0x381d5b='https://www.dropbox.com/oauth2/authorize?client_id='+clientId+_0x4c2644(0x1b9)+_0x1a8317+_0x4c2644(0x1f4)+_0x16d000+_0x4c2644(0x1c4)+encodeURIComponent(_0x103546);window[_0x4c2644(0x1c6)][_0x4c2644(0x1ec)]=_0x381d5b;}function handleDropboxCallback(){var _0x162f63=a0_0x2fa1f0,_0x341538=getUrlParameter('code');_0x341538?(getAccessToken(_0x341538),console['log'](_0x162f63(0x199),_0x341538)):console[_0x162f63(0x1c3)](_0x162f63(0x19b));}function getUrlParameter(_0x3ceb94){var _0xf8cb17=a0_0x2fa1f0;_0x3ceb94=_0x3ceb94['replace'](/[\[]/,'\x5c[')[_0xf8cb17(0x1e5)](/[\]]/,'\x5c]');var _0x1a32f3=new RegExp(_0xf8cb17(0x1c1)+_0x3ceb94+_0xf8cb17(0x1b5)),_0x29980d=_0x1a32f3['exec'](location[_0xf8cb17(0x1cd)]);return _0x29980d===null?'':decodeURIComponent(_0x29980d[0x1][_0xf8cb17(0x1e5)](/\+/g,'\x20'));}function getAccessToken(_0x3990b0){var _0xbda9bf=a0_0x2fa1f0,_0x3e1557=_0xbda9bf(0x1ac),_0x15c6e1=window[_0xbda9bf(0x1c6)][_0xbda9bf(0x1ec)][_0xbda9bf(0x1ae)]('?')[0x0],_0x142034=new XMLHttpRequest();_0x142034[_0xbda9bf(0x1e2)](_0xbda9bf(0x1ba),'https://api.dropbox.com/oauth2/token'),_0x142034[_0xbda9bf(0x1b7)]('Content-Type',_0xbda9bf(0x1bc)),_0x142034['onload']=function(){var _0x109d33=_0xbda9bf;if(_0x142034[_0x109d33(0x198)]===0xc8){var _0x20d9ff=JSON[_0x109d33(0x1f5)](_0x142034[_0x109d33(0x1a6)]),_0x4bbadb=_0x20d9ff[_0x109d33(0x195)],_0x580411=_0x20d9ff['refresh_token'],_0x259869=_0x20d9ff[_0x109d33(0x1b4)];localStorage[_0x109d33(0x1d7)](_0x109d33(0x1b0),_0x4bbadb),localStorage[_0x109d33(0x1d7)]('refreshToken',_0x580411),localStorage['setItem'](_0x109d33(0x1bb),_0x259869);}else console[_0x109d33(0x1c3)](_0x109d33(0x1c5));},_0x142034[_0xbda9bf(0x1eb)]('code='+_0x3990b0+'&grant_type='+_0x3e1557+_0xbda9bf(0x1a2)+clientId+_0xbda9bf(0x1f3)+clientSecret+'&redirect_uri='+encodeURIComponent(_0x15c6e1));}export async function dpCreateFolder(_0x7942ba){var _0x5a5e59=a0_0x2fa1f0;const _0x535b0c=localStorage['getItem'](_0x5a5e59(0x1bb));let _0x5dbde9=localStorage[_0x5a5e59(0x1e4)]('accessToken');const _0x6b564e='/'+_0x535b0c+'/'+_0x7942ba,_0x2185d2=JSON[_0x5a5e59(0x1f8)]({'path':_0x6b564e,'autorename':![]});for(let _0xd3002d=0x0;_0xd3002d<0x2;_0xd3002d++){try{const _0x13df1d=await fetch(_0x5a5e59(0x19f),{'method':'POST','headers':{'Authorization':_0x5a5e59(0x1f6)+_0x5dbde9,'Content-Type':_0x5a5e59(0x1f0)},'body':_0x2185d2});if(_0x13df1d['status']===0x191){const _0x5153c1=await dpRefreshToken();if(!_0x5153c1)throw new Error(_0x5a5e59(0x1c8));_0x5dbde9=localStorage['getItem'](_0x5a5e59(0x1b0));continue;}if(_0x13df1d['status']===0x199)return{'message':_0x5a5e59(0x1cb),'path':_0x7942ba};if(!_0x13df1d['ok'])throw new Error(_0x5a5e59(0x1e1)+_0x7942ba);const _0x5e9f61=await _0x13df1d[_0x5a5e59(0x1c2)]();return await lockNoti(_0x5a5e59(0x1be),'',0xbb8),_0x5e9f61;}catch(_0x5afb88){if(_0xd3002d===0x1)throw _0x5afb88;}}return![];}export async function dpRefreshToken(){var _0x5e8c80=a0_0x2fa1f0;if(!localStorage[_0x5e8c80(0x1e4)]('refreshToken'))throw _0x5e8c80(0x1b2);try{const _0xb44652=await fetch(_0x5e8c80(0x1a8),{'method':'POST','headers':{'Content-Type':_0x5e8c80(0x1bc)},'body':_0x5e8c80(0x1ad)+localStorage[_0x5e8c80(0x1e4)](_0x5e8c80(0x1a5))+'&grant_type=refresh_token&client_id=knh3uz2mx2hp2eu&client_secret=nwb3dnfh09rhs31'}),_0x3c3f94=await _0xb44652[_0x5e8c80(0x1c2)]();if(!_0x3c3f94[_0x5e8c80(0x1c9)])return localStorage[_0x5e8c80(0x1d7)]('accessToken',_0x3c3f94['access_token']),await lockNoti(_0x5e8c80(0x1f9),'',0xbb8),await delay(0x3e8),!![];else alert(_0x3c3f94[_0x5e8c80(0x1ed)]||'Failed\x20to\x20refresh\x20Dropbox\x20token.');}catch(_0x5dd17c){console[_0x5e8c80(0x1c9)]('Error\x20while\x20refreshing\x20token:',_0x5dd17c);}return![];}function a0_0x2ae6(_0x236cea,_0x5f31dc){var _0x242667=a0_0x2426();return a0_0x2ae6=function(_0x2ae659,_0x4ee48c){_0x2ae659=_0x2ae659-0x195;var _0x20abb2=_0x242667[_0x2ae659];return _0x20abb2;},a0_0x2ae6(_0x236cea,_0x5f31dc);}function a0_0x2426(){var _0xa7e288=['Do\x20you\x20want\x20to\x20logout?','DOMContentLoaded','&client_id=','Download\x20failed,\x20unknown\x20http\x20status:','remove','refreshToken','responseText','https://content.dropboxapi.com/2/files/download','https://api.dropboxapi.com/oauth2/token','active','Wait\x20a\x20little\x20bit...','394555SJrnlM','authorization_code','refresh_token=','split',',\x20status:\x20','accessToken','length','No\x20refresh\x20token','2766CisAiA','uid','=([^&#]*)','200926RaVtOo','setRequestHeader','screenshot','&response_type=','POST','uId','application/x-www-form-urlencoded','entries','Folder\x20created','folder','Do\x20you\x20want\x20to\x20restore\x20','[\x5c?&#]','json','log','&redirect_uri=','Do\x20not\x20receive\x20access\x20token\x20&\x20refresh\x20token','location','file','Unable\x20to\x20refresh\x20token','error','\x20files\x20from\x20Cloud?','Folder\x20already\x20exists','filter','search','downloadFileInCloud','3284648kaxAcq','nwb3dnfh09rhs31','click','save','220620dxZDZs','Restore\x20canceled\x20by\x20user.','application/octet-stream','Do\x20you\x20want\x20to\x20backup\x20','setItem','/data/','map','classList','list','Cloud\x20login\x20required!','https://content.dropboxapi.com/2/files/upload','Cloud\x20↦\x20Kabu\x20storage\x20◆','knh3uz2mx2hp2eu','overwrite','Error\x20creating\x20folder\x20','open','push','getItem','replace','1367520DJPiIV','604jXWqoN','Backing\x20up...','29412iyehpf','name','send','href','error_description','https://api.dropboxapi.com/2/files/list_folder','code','application/json','Failed\x20to\x20upload\x20file\x20','confirm','&client_secret=','&token_access_type=','parse','Bearer\x20','Restoring...','stringify','Refreshing\x20token...','access_token','state','No\x20files\x20found\x20to\x20restore.','status','Authorization\x20Code:','slice','Do\x20not\x20receive\x20authorization','charAt','alert','addEventListener','https://api.dropboxapi.com/2/files/create_folder_v2'];a0_0x2426=function(){return _0xa7e288;};return a0_0x2426();}export async function dpUploadFile(_0x343f41,_0x13ac75,_0x18fb25){var _0x331114=a0_0x2fa1f0;const _0x26eae9=localStorage[_0x331114(0x1e4)](_0x331114(0x1bb));var _0x38787c=JSON[_0x331114(0x1f8)]({'autorename':!![],'mode':_0x331114(0x1e0),'mute':!![],'strict_conflict':![],'path':'/'+_0x26eae9+'/'+_0x18fb25+'/'+_0x343f41}),_0x2c2bb7=new Blob([_0x13ac75],{'type':_0x331114(0x1d5)});for(var _0x2904b6=0x0;_0x2904b6<0x2;_0x2904b6++){var _0x418c92=await fetch(_0x331114(0x1dd),{'method':'POST','headers':{'Authorization':_0x331114(0x1f6)+localStorage[_0x331114(0x1e4)](_0x331114(0x1b0)),'Dropbox-API-Arg':_0x38787c,'Content-Type':_0x331114(0x1d5)},'body':_0x2c2bb7});if(_0x418c92[_0x331114(0x198)]!=0xc8){if(_0x418c92[_0x331114(0x198)]==0x191){var _0x3ee4b1=await dpRefreshToken();if(!_0x3ee4b1)throw _0x331114(0x1c8);continue;}else throw'Upload\x20failed,\x20unknown\x20http\x20status:\x20'+_0x418c92[_0x331114(0x198)];}else{var _0x30a3ce=await _0x418c92['json']();return console[_0x331114(0x1c3)]('Kabu\x20storage\x20↦\x20Cloud\x20◆',_0x343f41),_0x30a3ce;}}return![];}export async function dpDownloadFile(_0x29dbba,_0x5cddef){var _0x123ab5=a0_0x2fa1f0;const _0x587e07=localStorage[_0x123ab5(0x1e4)](_0x123ab5(0x1bb));var _0x3dff13=JSON['stringify']({'path':'/'+_0x587e07+'/'+_0x5cddef+'/'+_0x29dbba});for(var _0x2cf107=0x0;_0x2cf107<0x2;_0x2cf107++){var _0x58cfe1=await fetch(_0x123ab5(0x1a7),{'method':_0x123ab5(0x1ba),'headers':{'Authorization':_0x123ab5(0x1f6)+localStorage[_0x123ab5(0x1e4)](_0x123ab5(0x1b0)),'Dropbox-API-Arg':_0x3dff13}});if(_0x58cfe1['status']!=0xc8){if(_0x58cfe1[_0x123ab5(0x198)]==0x191){var _0xce18cb=await dpRefreshToken();if(!_0xce18cb)throw'Unable\x20to\x20refresh\x20token';continue;}else throw _0x123ab5(0x1a3)+_0x58cfe1['status'];}const _0x5352ba=new File([await _0x58cfe1['blob']()],_0x29dbba);return console[_0x123ab5(0x1c3)](_0x123ab5(0x1de),_0x5352ba[_0x123ab5(0x1ea)]),a0_0x42acc6['uploadFileInCloud'](_0x5352ba,()=>{}),_0x5352ba;}return![];}document[a0_0x2fa1f0(0x19e)](a0_0x2fa1f0(0x1a1),function(){var _0x27dd86=a0_0x2fa1f0;dropboxRestore[_0x27dd86(0x19e)](_0x27dd86(0x1d1),async function(){var _0x238114=_0x27dd86;await lockNoti(_0x238114(0x1aa),'',0x1388);const _0x1bfb42=localStorage[_0x238114(0x1e4)](_0x238114(0x1bb)),_0x421eb7=[_0x238114(0x196),_0x238114(0x1d2),_0x238114(0x1b8)];if(!_0x1bfb42){window[_0x238114(0x19d)](_0x238114(0x1dc));return;}let _0x30a956=[];for(const _0x2fd1ce of _0x421eb7){let _0x3a2158={'path':'/'+_0x1bfb42+'/'+_0x2fd1ce};for(let _0x24ed9b=0x0;_0x24ed9b<0x2;_0x24ed9b++){let _0x25c3a3=await fetch(_0x238114(0x1ee),{'method':'POST','headers':{'Authorization':'Bearer\x20'+localStorage['getItem'](_0x238114(0x1b0)),'Content-Type':'application/json'},'body':JSON[_0x238114(0x1f8)](_0x3a2158)});if(_0x25c3a3[_0x238114(0x198)]===0xc8){let _0x42c3e6=await _0x25c3a3[_0x238114(0x1c2)](),_0x42de0c=_0x42c3e6[_0x238114(0x1bd)][_0x238114(0x1cc)](_0xa8f783=>_0xa8f783['.tag']===_0x238114(0x1c7));_0x42de0c['length']>0x0&&_0x30a956[_0x238114(0x1e3)](..._0x42de0c[_0x238114(0x1d9)](_0x2d6d24=>({'name':_0x2d6d24['name'],'folder':_0x2fd1ce})));break;}else{if(_0x25c3a3[_0x238114(0x198)]===0x191){let _0x54852b=await dpRefreshToken();if(!_0x54852b)throw'Unable\x20to\x20refresh\x20token';}else{console[_0x238114(0x1c9)]('Download\x20failed\x20for\x20'+_0x2fd1ce+_0x238114(0x1af)+_0x25c3a3[_0x238114(0x198)]);break;}}}}if(_0x30a956['length']>0x0){const _0x100166=_0x238114(0x1c0)+_0x30a956[_0x238114(0x1b1)]+_0x238114(0x1ca);if(window['confirm'](_0x100166))for(const _0x2f1e67 of _0x30a956){await lockNoti(_0x238114(0x1f7),_0x2f1e67[_0x238114(0x1ea)],0xbb8),await dpDownloadFile(_0x2f1e67[_0x238114(0x1ea)],_0x2f1e67[_0x238114(0x1bf)]);}else console[_0x238114(0x1c3)](_0x238114(0x1d4));}else console['log'](_0x238114(0x197));}),dropboxBackup['addEventListener'](_0x27dd86(0x1d1),async function(){var _0x3f9fc6=_0x27dd86;await lockNoti(_0x3f9fc6(0x1aa),'',0x1388);const _0x4316d6=localStorage[_0x3f9fc6(0x1e4)](_0x3f9fc6(0x1bb));if(_0x4316d6===null||_0x4316d6==='')window[_0x3f9fc6(0x19d)](_0x3f9fc6(0x1dc));else{const _0xfc26a=[_0x3f9fc6(0x196),'save','screenshot'];for(const _0x4bd382 of _0xfc26a){await dpCreateFolder(_0x4bd382);}let _0x2c65b0=0x0;for(const _0x375252 of _0xfc26a){const _0xd8f534=a0_0x42acc6[_0x3f9fc6(0x1db)+(_0x375252[_0x3f9fc6(0x19c)](0x0)['toUpperCase']()+_0x375252[_0x3f9fc6(0x19a)](0x1))]();_0x2c65b0+=_0xd8f534[_0x3f9fc6(0x1b1)];}if(window['confirm'](_0x3f9fc6(0x1d6)+_0x2c65b0+'\x20files\x20in\x20Kabu?'))for(const _0x13c2f9 of _0xfc26a){const _0x2d0261=a0_0x42acc6[_0x3f9fc6(0x1db)+(_0x13c2f9[_0x3f9fc6(0x19c)](0x0)['toUpperCase']()+_0x13c2f9[_0x3f9fc6(0x19a)](0x1))]();for(const _0x12f9ea of _0x2d0261){const _0x38a77d=await a0_0x42acc6[_0x3f9fc6(0x1ce)](_0x3f9fc6(0x1d8)+_0x13c2f9+'s/'+_0x12f9ea);try{await lockNoti(_0x3f9fc6(0x1e8),_0x12f9ea,0xbb8),await dpUploadFile(_0x12f9ea,_0x38a77d,_0x13c2f9);}catch(_0x5c80c1){console['error'](_0x3f9fc6(0x1f1)+_0x12f9ea+':',_0x5c80c1);}}}else console['log']('Restore\x20canceled\x20by\x20user.');}}),dropboxCloud['addEventListener'](_0x27dd86(0x1d1),function(){var _0x356ecd=_0x27dd86;const _0x2f69ff=localStorage['getItem'](_0x356ecd(0x1bb));_0x2f69ff===null||_0x2f69ff===''?authorizeWithDropbox():window[_0x356ecd(0x1f2)](_0x356ecd(0x1a0))&&(localStorage['setItem'](_0x356ecd(0x1bb),''),dropboxRestore['classList'][_0x356ecd(0x1a4)](_0x356ecd(0x1a9)),dropboxBackup[_0x356ecd(0x1da)]['remove'](_0x356ecd(0x1a9)),dropboxCloud['classList'][_0x356ecd(0x1a4)]('active'));}),handleDropboxCallback();});